.. _extension:

Extension Fitting
=================

The :py:meth:`~fermipy.gtanalysis.GTAnalysis.extension` method executes
a source extension analysis for a given source by computing a
likelihood ratio test with respect to the no-extension (point-source)
hypothesis and a best-fit model for extension.  The best-fit extension
is evaluated by a likelihood profile scan over the source width.
Currently this method supports two models for extension: a 2D Gaussian
(*GaussianSource*) or a 2D disk (*DiskSource*).

The default configuration of
:py:meth:`~fermipy.gtanalysis.GTAnalysis.extension` is defined in the
*extension* section of the configuration file:

.. csv-table:: *extension* Options
   :header:    Option, Default, Description
   :file: ../config/extension.csv
   :delim: tab
   :widths: 10,10,80

At runtime the default settings for the extension analysis can be
overriden by passing one or more *kwargs* when executing
:py:meth:`~fermipy.gtanalysis.GTAnalysis.extension`:

.. code-block:: python
   
   # Run extension fit of sourceA with default settings
   >>> gta.extension('sourceA')

   # Override default spatial model
   >>> gta.extension('sourceA',spatial_model='DiskSource')

By default the extension method will profile over any background parameters
that were free when the method was executed.  One can optionally fix
all background parameters with the *fix_background* parameter:

.. code-block:: python
   
   # Free a nearby source that maybe be partially degenerate with the
   # source of interest
   gta.free_norm('sourceB')

   # Normalization of SourceB will be refit when testing the extension
   # of sourceA
   gta.extension('sourceA')

   # Fix all background parameters when testing the extension
   # of sourceA
   gta.extension('sourceA',fix_background=True)

The results of the extension analysis are written to a dictionary
which is the return value of the extension method.  This dictionary
is also written to the *extension* dictionary of the corresponding
source and will also be saved in the output file generated by
:py:meth:`~fermipy.gtanalysis.GTAnalysis.write_roi`.
   
.. code-block:: python
   
   ext = gta.extension('sourceA')

   ext = gta.roi['sourceA']
   
The contents of the output dictionary are described in the following table:

============= =================================================================
Key           Description
============= =================================================================
dlogLike      Sequence of delta-log-likelihood values for each point
              in the profile likelihood scan.
logLike       Sequence of likelihood values for each point in the scan over the spatial extension.
logLike_ptsrc Log-Likelihood value of the best-fit point-source model.
logLike_base  Log-Likelihood value of the baseline model.
ext           Best-fit extension in degrees.
ext_err_hi    Upper (1 sigma) error on the best-fit extension in degrees.
ext_err_lo    Lower (1 sigma) error on the best-fit extension in degrees.
ext_err       Symmetric (1 sigma) error on the best-fit extension in degrees.
ext_ul95      95% CL upper limit on the extension in degrees.
width         List of width parameters.
ts_ext        Test statistic for the extension hypothesis.
source_fit    Dictionary with parameters of the best-fit extended source model.
config        Copy of the input parameters to this method.
============= =================================================================


Reference/API
-------------

.. automethod:: fermipy.gtanalysis.GTAnalysis.extension
   :noindex:


